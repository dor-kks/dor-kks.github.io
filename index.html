<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    #muteButton {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 9999;
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>

<body>
  <a-scene mindar-image="imageTargetSrc: ./targets.mind;" maxTrack="2"
           color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights"
           vr-mode-ui="enabled: false"
           device-orientation-permission-ui="enabled: false">

    <a-assets>
      <!-- MARKER 0: transparent WebM video + audio -->
      <video id="video2" src="./assets/cemetery-nft-video.webm"
             autoplay loop muted playsinline crossorigin="anonymous"></video>
      <audio id="audio2" src="./assets/cemetery-nft-audio.mp3" preload="auto"></audio>

      <!-- MARKER 1: transparent WebM video + audio -->
      <video id="video1" src="./assets/cemetery-dotcom-video.webm"
             autoplay loop muted playsinline crossorigin="anonymous"></video>
      <audio id="audio1" src="./assets/cemetery-dotcom-audio.mp3" preload="auto"></audio>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- MARKER 0 â†’ video2 + audio2 -->
    <a-entity id="marker0" mindar-image-target="targetIndex: 0">
      <a-plane width="1.8" height="3.555"
               material="src: #video2; transparent: true;"></a-plane>
    </a-entity>

    <!-- MARKER 1 â†’ video1 + audio1 -->
    <a-entity id="marker1" mindar-image-target="targetIndex: 1">
      <a-plane width="1.8" height="3.555"
               material="src: #video1; transparent: true;"></a-plane>
    </a-entity>

  </a-scene>

  <button id="muteButton">ðŸ”‡</button>

  <script>
    const video1 = document.querySelector("#video1");
    const video2 = document.querySelector("#video2");
    const audio1 = document.querySelector("#audio1");
    const audio2 = document.querySelector("#audio2");
    const marker0 = document.querySelector("#marker0");
    const marker1 = document.querySelector("#marker1");
    const muteBtn = document.querySelector("#muteButton");

    // Keep portrait ratio for both videos
    const videoRatio = 1080 / 1920;
    const width = 1.8;
    const height = width / videoRatio;

    document.querySelectorAll("a-plane").forEach(plane => {
      plane.setAttribute("width", width);
      plane.setAttribute("height", height);
    });

    // Marker 0 events â†’ video2 + audio2
    marker0.addEventListener("targetFound", () => {
      video2.currentTime = 0;
      audio2.currentTime = 0;
      video2.play();
      audio2.play();
    });
    marker0.addEventListener("targetLost", () => {
      video2.pause();
      audio2.pause();
      audio2.currentTime = 0;
    });

    // Marker 1 events â†’ video1 + audio1
    marker1.addEventListener("targetFound", () => {
      video1.currentTime = 0;
      audio1.currentTime = 0;
      video1.play();
      audio1.play();
    });
    marker1.addEventListener("targetLost", () => {
      video1.pause();
      audio1.pause();
      audio1.currentTime = 0;
    });

    // Unlock audio on first tap (required by browsers)
    function unlockAudio() {
      audio1.play().then(() => audio1.pause());
      audio2.play().then(() => audio2.pause());
      window.removeEventListener("touchstart", unlockAudio);
      window.removeEventListener("click", unlockAudio);
    }
    window.addEventListener("touchstart", unlockAudio);
    window.addEventListener("click", unlockAudio);

    // Mute / unmute button
    muteBtn.addEventListener("click", () => {
      const anyPlaying = !audio1.paused || !audio2.paused;
      if (anyPlaying) {
        audio1.pause();
        audio2.pause();
        muteBtn.textContent = "ðŸ”‡";
      } else {
        if (!video1.paused) audio1.play();
        if (!video2.paused) audio2.play();
        muteBtn.textContent = "ðŸ”Š";
      }
    });
  </script>

</body>
</html>
