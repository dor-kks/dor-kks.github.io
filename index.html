<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    #muteButton {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 9999;
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <a-scene mindar-image="imageTargetSrc: ./targets.mind;" maxTrack="2"
           color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights"
           vr-mode-ui="enabled: false"
           device-orientation-permission-ui="enabled: false">

    <a-assets>
      <video id="video1" src="./assets/cemetery-dotcom-video.mp4"
             preload="auto" loop="true" playsinline="true"
             crossorigin="anonymous" muted></video>

      <audio id="audio1" src="./assets/cemetery-dotcom-audio.mp3" preload="auto"></audio>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">
      <a-plane id="video-plane" src="#video1" width="1.8" height="3.555"></a-plane>
    </a-entity>
  </a-scene>

  <!-- Mute/unmute button -->
  <button id="muteButton">ðŸ”‡</button>

  <script>
    const video = document.querySelector("#video1");
    const audio = document.querySelector("#audio1");
    const target = document.querySelector("[mindar-image-target]");
    const plane = document.querySelector("#video-plane");
    const muteBtn = document.querySelector("#muteButton");

    // Keep video plane portrait ratio
    const videoRatio = 1080 / 1920;
    const width = 1.8;
    const height = width / videoRatio;
    plane.setAttribute("width", width);
    plane.setAttribute("height", height);

    // Play/pause video on target
    target.addEventListener("targetFound", () => video.play());
    target.addEventListener("targetLost", () => video.pause());

    // First tap starts audio
    function startAudio() {
      audio.currentTime = 0;
      audio.play();
      window.removeEventListener("touchstart", startAudio);
      window.removeEventListener("click", startAudio);
    }
    window.addEventListener("touchstart", startAudio);
    window.addEventListener("click", startAudio);

    // Mute/unmute button toggles audio
    muteBtn.addEventListener("click", () => {
      if (audio.paused) {
        audio.play();
        muteBtn.textContent = "ðŸ”Š";
      } else {
        audio.pause();
        muteBtn.textContent = "ðŸ”‡";
      }
    });
  </script>
</body>
</html>
